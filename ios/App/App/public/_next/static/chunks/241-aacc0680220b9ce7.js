"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{109:(e,r,t)=>{t.d(r,{Fe:()=>m,Gr:()=>x,H4:()=>y,Ll:()=>h,XG:()=>u,g:()=>i,ib:()=>f,pd:()=>c});var a=t(82964),n=t(52007),o=t(94548),l=t(63473),s=t(57194);let d="journalEntries";async function i(e){if(!e)return console.warn("[Journal] getJournalEntriesForUser: No userId provided."),[];console.log("[Journal] getJournalEntriesForUser called for userId: ".concat(e));try{let r=(0,a.P)((0,a.rJ)(n.db,d),(0,a._M)("userId","==",e),(0,a.My)("date","desc")),t=await (0,a.GG)(r),o=[];return t.forEach(e=>{o.push({id:e.id,...e.data()})}),console.log("[Journal] Found ".concat(o.length," entries for userId ").concat(e,".")),o}catch(r){throw console.error("[Journal] Error fetching journal entries for userId ".concat(e,":"),r),r}}async function c(e){if(!e)return console.warn("[Journal] getLatestJournalEntryForUser: No userId provided."),null;try{let r=(0,a.P)((0,a.rJ)(n.db,d),(0,a._M)("userId","==",e),(0,a.My)("date","desc"),(0,a.AB)(1)),t=await (0,a.GG)(r);if(!t.empty){let e=t.docs[0].data();return{id:t.docs[0].id,...e}}return null}catch(r){throw console.error("[Journal] Error fetching latest journal entry for userId ".concat(e,":"),r),r}}async function u(e){if(!e)return console.warn("[Journal] getJournalEntriesCountForUser: No userId provided."),0;try{let r=(0,a.P)((0,a.rJ)(n.db,d),(0,a._M)("userId","==",e));return(await (0,a.d_)(r)).data().count}catch(r){throw console.error("[Journal] Error fetching journal entry count for userId ".concat(e,":"),r),r}}async function f(e,r){if(!e)return console.warn("[Journal] getJournalEntriesForLastNDays: No userId provided."),[];try{let t=new Date,i=(0,o.D)(t),c=(0,l.o)((0,s.e)(t,r-1)),u=(0,a.P)((0,a.rJ)(n.db,d),(0,a._M)("userId","==",e),(0,a._M)("date",">=",c.toISOString()),(0,a._M)("date","<=",i.toISOString()),(0,a.My)("date","desc")),f=await (0,a.GG)(u),m=[];return f.forEach(e=>{m.push({id:e.id,...e.data()})}),m}catch(t){throw console.error("[Journal] Error fetching journal entries for last ".concat(r," days for userId ").concat(e,":"),t),t}}async function m(e,r){if(!e)throw Error("[Journal] addJournalEntry: No userId provided.");console.log("[Journal] addJournalEntry called for userId: ".concat(e));try{let t=await (0,a.gS)((0,a.rJ)(n.db,d),{userId:e,content:r.content,moodRating:r.moodRating,date:r.date,createdAt:(0,a.O5)(),updatedAt:(0,a.O5)()});console.log("[Journal] Added entry with ID: ".concat(t.id," for userId ").concat(e,"."));let o=await (0,a.x7)(t);return{id:o.id,...o.data()}}catch(r){throw console.error("[Journal] Error adding journal entry for userId ".concat(e,":"),r),r}}async function x(e){if(console.log("[Journal] getJournalEntryById called for entryId: ".concat(e)),!e)return console.warn("[Journal] getJournalEntryById: No entryId provided."),null;try{let r=(0,a.H9)(n.db,d,e),t=await (0,a.x7)(r);if(!t.exists())return console.log("[Journal] No entry found for ID ".concat(e,".")),null;{let e={id:t.id,...t.data()};return console.log("[Journal] Found entry by ID:",e),e}}catch(r){throw console.error("[Journal] Error fetching journal entry by ID ".concat(e,":"),r),r}}async function h(e,r){if(console.log("[Journal] updateJournalEntry called for entryId: ".concat(e)),!e)throw Error("[Journal] updateJournalEntry: No entryId provided.");try{let t=(0,a.H9)(n.db,d,e);if(!(await (0,a.x7)(t)).exists())return console.warn("[Journal] Update failed: No entry found for ID ".concat(e,".")),null;let o={...r};r.date&&(o.date=r.date),o.updatedAt=(0,a.O5)(),await (0,a.mZ)(t,o),console.log("[Journal] Updated entry with ID: ".concat(e,"."));let l=await (0,a.x7)(t);if(l.exists())return{id:l.id,...l.data()};return null}catch(r){throw console.error("[Journal] Error updating journal entry ".concat(e,":"),r),r}}async function y(e){if(console.log("[Journal] deleteJournalEntry called for entryId: ".concat(e)),!e)throw Error("[Journal] deleteJournalEntry: No entryId provided.");try{let r=(0,a.H9)(n.db,d,e);return await (0,a.kd)(r),console.log("[Journal] Deleted entry with ID: ".concat(e,".")),!0}catch(r){throw console.error("[Journal] Error deleting journal entry ".concat(e,":"),r),r}}},5747:(e,r,t)=>{t.d(r,{L:()=>o});var a=t(37876),n=t(46907);function o(e){let{children:r,className:t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("container mx-auto px-4 py-8 sm:px-6 lg:px-8",t),children:r})}},20959:(e,r,t)=>{t.d(r,{A:()=>s});var a=t(37876),n=t(14232),o=t(85050),l=t(46907);let s=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsxs)(o.bL,{ref:r,className:(0,l.cn)("relative flex w-full touch-none select-none items-center",t),...n,children:[(0,a.jsx)(o.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)(o.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(o.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});s.displayName=o.bL.displayName},23179:(e,r,t)=>{t.d(r,{$v:()=>h,EO:()=>u,Lt:()=>d,Rx:()=>y,Zr:()=>p,ck:()=>m,r7:()=>x,wd:()=>f});var a=t(37876),n=t(14232),o=t(91806),l=t(46907),s=t(42740);let d=o.bL;o.l9;let i=o.ZL,c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(o.hJ,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n,ref:r})});c.displayName=o.hJ.displayName;let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsxs)(i,{children:[(0,a.jsx)(c,{}),(0,a.jsx)(o.UC,{ref:r,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n})]})});u.displayName=o.UC.displayName;let f=e=>{let{className:r,...t}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",r),...t})};f.displayName="AlertDialogHeader";let m=e=>{let{className:r,...t}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t})};m.displayName="AlertDialogFooter";let x=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(o.hE,{ref:r,className:(0,l.cn)("text-lg font-semibold",t),...n})});x.displayName=o.hE.displayName;let h=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(o.VY,{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",t),...n})});h.displayName=o.VY.displayName;let y=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(o.rc,{ref:r,className:(0,l.cn)((0,s.r)(),t),...n})});y.displayName=o.rc.displayName;let p=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)(o.ZD,{ref:r,className:(0,l.cn)((0,s.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...n})});p.displayName=o.ZD.displayName},63474:(e,r,t)=>{t.d(r,{T:()=>l});var a=t(37876),n=t(14232),o=t(46907);let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...n})});l.displayName="Textarea"},66241:(e,r,t)=>{t.r(r),t.d(r,{default:()=>I});var a=t(37876),n=t(14232),o=t(14e3),l=t(5747),s=t(72636),d=t(49105),i=t(109),c=t(90034),u=t(42740),f=t(98009),m=t(1629),x=t(5686),h=t(62757),y=t(80579),p=t(12769),g=t(34855),v=t(38684);let b=(0,v.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),j=(0,v.A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var w=t(66388),N=t(75122),J=t(31928),E=t(23179);function I(e){var r,t;let{params:v}=e,{user:I,isLoading:k}=(0,d.A)(),R=(0,o.useRouter)(),{toast:A}=(0,J.dj)(),M=(0,o.useParams)(),S=(null==v?void 0:v.id)||(M&&"string"==typeof M.id?M.id:void 0),[C,D]=(0,n.useState)(null),[L,F]=(0,n.useState)(!0),[H,z]=(0,n.useState)(!1),[G,_]=(0,n.useState)(!1),[O,P]=(0,n.useState)(!1),U=(0,n.useCallback)(async()=>{if(k||!I||!S){k||I||!S||(A({title:"Authentication Required",description:"Please log in to view journal entries.",variant:"destructive"}),R.replace("/login")),k||I&&S||F(!1);return}F(!0);try{let e=await (0,i.Gr)(S);e?e.userId===I.id?D(e):(A({title:"Access Denied",description:"You do not have permission to view this entry.",variant:"destructive"}),R.replace("/journal")):(A({title:"Error",description:"Journal entry not found.",variant:"destructive"}),R.replace("/journal"))}catch(e){console.error("Failed to fetch entry:",e),A({title:"Error",description:"Could not load the journal entry.",variant:"destructive"}),R.replace("/journal")}finally{F(!1)}},[S,R,A,I,k]);(0,n.useEffect)(()=>{k||U()},[U,k]);let Z=async e=>{if(null==C?void 0:C.id){_(!0);try{let r=await (0,i.Ll)(C.id,{...e,date:new Date().toISOString()});r?(D(r),A({title:"Success",description:"Journal entry updated."}),z(!1)):A({title:"Error",description:"Failed to update entry.",variant:"destructive"})}catch(e){A({title:"Error",description:"An error occurred while updating.",variant:"destructive"})}finally{_(!1)}}},B=async()=>{if(null==C?void 0:C.id){_(!0);try{await (0,i.H4)(C.id),A({title:"Success",description:"Journal entry deleted."}),R.push("/journal")}catch(e){A({title:"Error",description:"Failed to delete entry.",variant:"destructive"}),_(!1),P(!1)}}};return k||L?(0,a.jsx)(l.L,{className:"flex justify-center items-center min-h-[calc(100vh-200px)]",children:(0,a.jsx)(g.A,{className:"h-12 w-12 animate-spin text-primary"})}):I?C?(0,a.jsxs)(l.L,{children:[(0,a.jsxs)(u.$,{variant:"ghost",onClick:()=>R.back(),className:"mb-4 text-primary hover:bg-primary/10",children:[(0,a.jsx)(b,{className:"mr-2 h-4 w-4"})," Back to Journal"]}),H?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.s,{children:"Edit Journal Entry"}),(0,a.jsx)(c.Zp,{className:"shadow-lg",children:(0,a.jsxs)(c.Wu,{className:"p-6",children:[(0,a.jsx)(N.k,{onSubmit:Z,initialData:C,isSubmitting:G}),(0,a.jsx)(u.$,{variant:"outline",onClick:()=>z(!1),className:"mt-4",disabled:G,children:"Cancel Edit"})]})})]}):(0,a.jsxs)(c.Zp,{className:"shadow-lg",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c.ZB,{className:"font-headline text-2xl mb-1",children:(0,m.GP)((0,x.H)(C.date),"MMMM d, yyyy")}),(0,a.jsx)(c.BT,{children:(0,m.GP)((0,x.H)(C.date),"h:mm a")})]}),(0,a.jsxs)(f.E,{variant:"outline",className:"flex items-center gap-2 text-lg px-4 py-2 rounded-lg ".concat((r=C.moodRating)>=8?"bg-green-100 text-green-700 border-green-300":r>=5?"bg-yellow-100 text-yellow-700 border-yellow-300":"bg-red-100 text-red-700 border-red-300"),children:[(t=C.moodRating)>=8?(0,a.jsx)(h.A,{className:"h-5 w-5 text-green-500"}):t>=5?(0,a.jsx)(y.A,{className:"h-5 w-5 text-yellow-500"}):(0,a.jsx)(p.A,{className:"h-5 w-5 text-red-500"}),"Mood: ",C.moodRating,"/10"]})]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)("p",{className:"text-foreground leading-relaxed whitespace-pre-wrap text-base py-4 border-t border-b",children:C.content})}),(0,a.jsxs)(c.wL,{className:"flex justify-end gap-2 pt-4",children:[(0,a.jsxs)(u.$,{variant:"outline",onClick:()=>z(!0),className:"border-primary text-primary hover:bg-primary/10",children:[(0,a.jsx)(j,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,a.jsxs)(u.$,{variant:"destructive",onClick:()=>P(!0),className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]}),(0,a.jsx)(E.Lt,{open:O,onOpenChange:P,children:(0,a.jsxs)(E.EO,{children:[(0,a.jsxs)(E.wd,{children:[(0,a.jsx)(E.r7,{children:"Are you sure?"}),(0,a.jsx)(E.$v,{children:"This action cannot be undone. This will permanently delete this journal entry."})]}),(0,a.jsxs)(E.ck,{children:[(0,a.jsx)(E.Zr,{disabled:G,children:"Cancel"}),(0,a.jsx)(E.Rx,{onClick:B,disabled:G,className:"bg-destructive hover:bg-destructive/90 text-destructive-foreground",children:G?(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}):"Delete"})]})]})})]}):(0,a.jsxs)(l.L,{children:[(0,a.jsx)(s.s,{children:"Entry Not Found"}),(0,a.jsx)("p",{children:"This journal entry could not be loaded or you do not have permission to view it."})]}):(0,a.jsxs)(l.L,{children:[(0,a.jsx)(s.s,{children:"Access Denied"}),(0,a.jsx)("p",{children:"You must be logged in to view this page."})]})}},72636:(e,r,t)=>{t.d(r,{s:()=>o});var a=t(37876),n=t(46907);function o(e){let{children:r,className:t}=e;return(0,a.jsx)("h1",{className:(0,n.cn)("text-2xl sm:text-3xl font-headline font-bold text-primary mb-6",t),children:r})}},75122:(e,r,t)=>{t.d(r,{k:()=>h});var a=t(37876),n=t(88992),o=t(13810),l=t(60513),s=t(42740),d=t(63474),i=t(20959),c=t(94890),u=t(34855);let f=(0,t(38684).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var m=t(14232);let x=l.Ik({content:l.Yj().min(10,{message:"Journal entry must be at least 10 characters."}).max(1e4,{message:"Journal entry must be 10,000 characters or less."}),moodRating:l.ai().min(1).max(10)});function h(e){let{onSubmit:r,initialData:t,isSubmitting:l}=e,h=(0,n.mN)({resolver:(0,o.u)(x),defaultValues:{content:(null==t?void 0:t.content)||"",moodRating:(null==t?void 0:t.moodRating)||5}}),[y,p]=(0,m.useState)((null==t?void 0:t.moodRating)||5),g=async e=>{await r(e)};return(0,a.jsx)(c.lV,{...h,children:(0,a.jsxs)("form",{onSubmit:h.handleSubmit(g),className:"space-y-8",children:[(0,a.jsx)(c.zB,{control:h.control,name:"content",render:e=>{let{field:r}=e;return(0,a.jsxs)(c.eI,{children:[(0,a.jsx)(c.lR,{className:"text-lg",children:"How are you feeling today?"}),(0,a.jsx)(c.MJ,{children:(0,a.jsx)(d.T,{placeholder:"Write about your day, your thoughts, your feelings...",className:"min-h-[200px] resize-none text-base",...r})}),(0,a.jsx)(c.Rr,{children:"Take your time and express yourself freely. (Max 10,000 characters)"}),(0,a.jsx)(c.C5,{})]})}}),(0,a.jsx)(c.zB,{control:h.control,name:"moodRating",render:e=>{let{field:r}=e;return(0,a.jsxs)(c.eI,{children:[(0,a.jsxs)(c.lR,{className:"text-lg",children:["Overall Mood Rating: ",y,"/10"]}),(0,a.jsx)(c.MJ,{children:(0,a.jsx)(i.A,{value:[r.value],max:10,min:1,step:1,onValueChange:e=>{r.onChange(e[0]),p(e[0])},className:"my-4","aria-label":"Mood rating slider"})}),(0,a.jsx)(c.Rr,{children:"1 being very low, 10 being extremely positive."}),(0,a.jsx)(c.C5,{})]})}}),(0,a.jsxs)(s.$,{type:"submit",className:"w-full sm:w-auto bg-primary hover:bg-primary/90 text-primary-foreground",disabled:l,children:[l?(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(f,{className:"mr-2 h-4 w-4"}),(null==t?void 0:t.id)?"Update Entry":"Save Entry"]})]})})}},98009:(e,r,t)=>{t.d(r,{E:()=>s});var a=t(37876);t(14232);var n=t(47137),o=t(46907);let l=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function s(e){let{className:r,variant:t,...n}=e;return(0,a.jsx)("div",{className:(0,o.cn)(l({variant:t}),r),...n})}}}]);