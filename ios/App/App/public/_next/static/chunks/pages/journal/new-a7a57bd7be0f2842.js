(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[226],{109:(e,r,t)=>{"use strict";t.d(r,{Fe:()=>y,Gr:()=>g,H4:()=>m,Ll:()=>h,XG:()=>u,g:()=>i,ib:()=>f,pd:()=>d});var n=t(82964),o=t(52007),a=t(94548),l=t(63473),s=t(57194);let c="journalEntries";async function i(e){if(!e)return console.warn("[Journal] getJournalEntriesForUser: No userId provided."),[];console.log("[Journal] getJournalEntriesForUser called for userId: ".concat(e));try{let r=(0,n.P)((0,n.rJ)(o.db,c),(0,n._M)("userId","==",e),(0,n.My)("date","desc")),t=await (0,n.GG)(r),a=[];return t.forEach(e=>{a.push({id:e.id,...e.data()})}),console.log("[Journal] Found ".concat(a.length," entries for userId ").concat(e,".")),a}catch(r){throw console.error("[Journal] Error fetching journal entries for userId ".concat(e,":"),r),r}}async function d(e){if(!e)return console.warn("[Journal] getLatestJournalEntryForUser: No userId provided."),null;try{let r=(0,n.P)((0,n.rJ)(o.db,c),(0,n._M)("userId","==",e),(0,n.My)("date","desc"),(0,n.AB)(1)),t=await (0,n.GG)(r);if(!t.empty){let e=t.docs[0].data();return{id:t.docs[0].id,...e}}return null}catch(r){throw console.error("[Journal] Error fetching latest journal entry for userId ".concat(e,":"),r),r}}async function u(e){if(!e)return console.warn("[Journal] getJournalEntriesCountForUser: No userId provided."),0;try{let r=(0,n.P)((0,n.rJ)(o.db,c),(0,n._M)("userId","==",e));return(await (0,n.d_)(r)).data().count}catch(r){throw console.error("[Journal] Error fetching journal entry count for userId ".concat(e,":"),r),r}}async function f(e,r){if(!e)return console.warn("[Journal] getJournalEntriesForLastNDays: No userId provided."),[];try{let t=new Date,i=(0,a.D)(t),d=(0,l.o)((0,s.e)(t,r-1)),u=(0,n.P)((0,n.rJ)(o.db,c),(0,n._M)("userId","==",e),(0,n._M)("date",">=",d.toISOString()),(0,n._M)("date","<=",i.toISOString()),(0,n.My)("date","desc")),f=await (0,n.GG)(u),y=[];return f.forEach(e=>{y.push({id:e.id,...e.data()})}),y}catch(t){throw console.error("[Journal] Error fetching journal entries for last ".concat(r," days for userId ").concat(e,":"),t),t}}async function y(e,r){if(!e)throw Error("[Journal] addJournalEntry: No userId provided.");console.log("[Journal] addJournalEntry called for userId: ".concat(e));try{let t=await (0,n.gS)((0,n.rJ)(o.db,c),{userId:e,content:r.content,moodRating:r.moodRating,date:r.date,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()});console.log("[Journal] Added entry with ID: ".concat(t.id," for userId ").concat(e,"."));let a=await (0,n.x7)(t);return{id:a.id,...a.data()}}catch(r){throw console.error("[Journal] Error adding journal entry for userId ".concat(e,":"),r),r}}async function g(e){if(console.log("[Journal] getJournalEntryById called for entryId: ".concat(e)),!e)return console.warn("[Journal] getJournalEntryById: No entryId provided."),null;try{let r=(0,n.H9)(o.db,c,e),t=await (0,n.x7)(r);if(!t.exists())return console.log("[Journal] No entry found for ID ".concat(e,".")),null;{let e={id:t.id,...t.data()};return console.log("[Journal] Found entry by ID:",e),e}}catch(r){throw console.error("[Journal] Error fetching journal entry by ID ".concat(e,":"),r),r}}async function h(e,r){if(console.log("[Journal] updateJournalEntry called for entryId: ".concat(e)),!e)throw Error("[Journal] updateJournalEntry: No entryId provided.");try{let t=(0,n.H9)(o.db,c,e);if(!(await (0,n.x7)(t)).exists())return console.warn("[Journal] Update failed: No entry found for ID ".concat(e,".")),null;let a={...r};r.date&&(a.date=r.date),a.updatedAt=(0,n.O5)(),await (0,n.mZ)(t,a),console.log("[Journal] Updated entry with ID: ".concat(e,"."));let l=await (0,n.x7)(t);if(l.exists())return{id:l.id,...l.data()};return null}catch(r){throw console.error("[Journal] Error updating journal entry ".concat(e,":"),r),r}}async function m(e){if(console.log("[Journal] deleteJournalEntry called for entryId: ".concat(e)),!e)throw Error("[Journal] deleteJournalEntry: No entryId provided.");try{let r=(0,n.H9)(o.db,c,e);return await (0,n.kd)(r),console.log("[Journal] Deleted entry with ID: ".concat(e,".")),!0}catch(r){throw console.error("[Journal] Error deleting journal entry ".concat(e,":"),r),r}}},5747:(e,r,t)=>{"use strict";t.d(r,{L:()=>a});var n=t(37876),o=t(46907);function a(e){let{children:r,className:t}=e;return(0,n.jsx)("div",{className:(0,o.cn)("container mx-auto px-4 py-8 sm:px-6 lg:px-8",t),children:r})}},20959:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var n=t(37876),o=t(14232),a=t(85050),l=t(46907);let s=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsxs)(a.bL,{ref:r,className:(0,l.cn)("relative flex w-full touch-none select-none items-center",t),...o,children:[(0,n.jsx)(a.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,n.jsx)(a.Q6,{className:"absolute h-full bg-primary"})}),(0,n.jsx)(a.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});s.displayName=a.bL.displayName},31117:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/journal/new",function(){return t(86646)}])},33371:(e,r,t)=>{"use strict";function n(e,r){return e instanceof Date?new e.constructor(r):new Date(r)}t.d(r,{w:()=>n})},35549:(e,r,t)=>{"use strict";function n(e){let r=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===r?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===r||"string"==typeof e||"[object String]"===r?e:NaN)}t.d(r,{a:()=>n})},57194:(e,r,t)=>{"use strict";t.d(r,{e:()=>a});var n=t(35549),o=t(33371);function a(e,r){var t=-r;let a=(0,n.a)(e);return isNaN(t)?(0,o.w)(e,NaN):(t&&a.setDate(a.getDate()+t),a)}},63473:(e,r,t)=>{"use strict";t.d(r,{o:()=>o});var n=t(35549);function o(e){let r=(0,n.a)(e);return r.setHours(0,0,0,0),r}},63474:(e,r,t)=>{"use strict";t.d(r,{T:()=>l});var n=t(37876),o=t(14232),a=t(46907);let l=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,n.jsx)("textarea",{className:(0,a.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...o})});l.displayName="Textarea"},72636:(e,r,t)=>{"use strict";t.d(r,{s:()=>a});var n=t(37876),o=t(46907);function a(e){let{children:r,className:t}=e;return(0,n.jsx)("h1",{className:(0,o.cn)("text-2xl sm:text-3xl font-headline font-bold text-primary mb-6",t),children:r})}},75122:(e,r,t)=>{"use strict";t.d(r,{k:()=>h});var n=t(37876),o=t(88992),a=t(13810),l=t(60513),s=t(42740),c=t(63474),i=t(20959),d=t(94890),u=t(34855);let f=(0,t(38684).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var y=t(14232);let g=l.Ik({content:l.Yj().min(10,{message:"Journal entry must be at least 10 characters."}).max(1e4,{message:"Journal entry must be 10,000 characters or less."}),moodRating:l.ai().min(1).max(10)});function h(e){let{onSubmit:r,initialData:t,isSubmitting:l}=e,h=(0,o.mN)({resolver:(0,a.u)(g),defaultValues:{content:(null==t?void 0:t.content)||"",moodRating:(null==t?void 0:t.moodRating)||5}}),[m,b]=(0,y.useState)((null==t?void 0:t.moodRating)||5),p=async e=>{await r(e)};return(0,n.jsx)(d.lV,{...h,children:(0,n.jsxs)("form",{onSubmit:h.handleSubmit(p),className:"space-y-8",children:[(0,n.jsx)(d.zB,{control:h.control,name:"content",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.eI,{children:[(0,n.jsx)(d.lR,{className:"text-lg",children:"How are you feeling today?"}),(0,n.jsx)(d.MJ,{children:(0,n.jsx)(c.T,{placeholder:"Write about your day, your thoughts, your feelings...",className:"min-h-[200px] resize-none text-base",...r})}),(0,n.jsx)(d.Rr,{children:"Take your time and express yourself freely. (Max 10,000 characters)"}),(0,n.jsx)(d.C5,{})]})}}),(0,n.jsx)(d.zB,{control:h.control,name:"moodRating",render:e=>{let{field:r}=e;return(0,n.jsxs)(d.eI,{children:[(0,n.jsxs)(d.lR,{className:"text-lg",children:["Overall Mood Rating: ",m,"/10"]}),(0,n.jsx)(d.MJ,{children:(0,n.jsx)(i.A,{value:[r.value],max:10,min:1,step:1,onValueChange:e=>{r.onChange(e[0]),b(e[0])},className:"my-4","aria-label":"Mood rating slider"})}),(0,n.jsx)(d.Rr,{children:"1 being very low, 10 being extremely positive."}),(0,n.jsx)(d.C5,{})]})}}),(0,n.jsxs)(s.$,{type:"submit",className:"w-full sm:w-auto bg-primary hover:bg-primary/90 text-primary-foreground",disabled:l,children:[l?(0,n.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,n.jsx)(f,{className:"mr-2 h-4 w-4"}),(null==t?void 0:t.id)?"Update Entry":"Save Entry"]})]})})}},86646:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>y});var n=t(37876),o=t(14232),a=t(14e3),l=t(75122),s=t(5747),c=t(72636),i=t(49105),d=t(109),u=t(31928),f=t(90034);function y(){let{user:e}=(0,i.A)(),r=(0,a.useRouter)(),{toast:t}=(0,u.dj)(),[y,g]=(0,o.useState)(!1),h=async n=>{if(!e)return void t({title:"Error",description:"You must be logged in to create an entry.",variant:"destructive"});g(!0);try{await (0,d.Fe)(e.id,{date:new Date().toISOString(),content:n.content,moodRating:n.moodRating}),t({title:"Success",description:"Journal entry saved successfully."}),r.push("/journal")}catch(e){t({title:"Error",description:"Failed to save journal entry.",variant:"destructive"}),console.error("Failed to save journal entry:",e)}finally{g(!1)}};return(0,n.jsxs)(s.L,{children:[(0,n.jsx)(c.s,{children:"New Journal Entry"}),(0,n.jsx)(f.Zp,{className:"shadow-lg",children:(0,n.jsx)(f.Wu,{className:"p-6",children:(0,n.jsx)(l.k,{onSubmit:h,isSubmitting:y})})})]})}},94548:(e,r,t)=>{"use strict";t.d(r,{D:()=>o});var n=t(35549);function o(e){let r=(0,n.a)(e);return r.setHours(23,59,59,999),r}}},e=>{var r=r=>e(e.s=r);e.O(0,[671,389,679,749,687,669,873,636,593,792],()=>r(31117)),_N_E=e.O()}]);