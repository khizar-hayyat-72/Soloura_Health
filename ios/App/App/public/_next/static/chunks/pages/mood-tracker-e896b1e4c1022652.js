(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{109:(e,r,t)=>{"use strict";t.d(r,{Fe:()=>h,Gr:()=>g,H4:()=>p,Ll:()=>y,XG:()=>c,g:()=>d,ib:()=>f,pd:()=>u});var o=t(82964),a=t(52007),n=t(94548),i=t(63473),l=t(57194);let s="journalEntries";async function d(e){if(!e)return console.warn("[Journal] getJournalEntriesForUser: No userId provided."),[];console.log("[Journal] getJournalEntriesForUser called for userId: ".concat(e));try{let r=(0,o.P)((0,o.rJ)(a.db,s),(0,o._M)("userId","==",e),(0,o.My)("date","desc")),t=await (0,o.GG)(r),n=[];return t.forEach(e=>{n.push({id:e.id,...e.data()})}),console.log("[Journal] Found ".concat(n.length," entries for userId ").concat(e,".")),n}catch(r){throw console.error("[Journal] Error fetching journal entries for userId ".concat(e,":"),r),r}}async function u(e){if(!e)return console.warn("[Journal] getLatestJournalEntryForUser: No userId provided."),null;try{let r=(0,o.P)((0,o.rJ)(a.db,s),(0,o._M)("userId","==",e),(0,o.My)("date","desc"),(0,o.AB)(1)),t=await (0,o.GG)(r);if(!t.empty){let e=t.docs[0].data();return{id:t.docs[0].id,...e}}return null}catch(r){throw console.error("[Journal] Error fetching latest journal entry for userId ".concat(e,":"),r),r}}async function c(e){if(!e)return console.warn("[Journal] getJournalEntriesCountForUser: No userId provided."),0;try{let r=(0,o.P)((0,o.rJ)(a.db,s),(0,o._M)("userId","==",e));return(await (0,o.d_)(r)).data().count}catch(r){throw console.error("[Journal] Error fetching journal entry count for userId ".concat(e,":"),r),r}}async function f(e,r){if(!e)return console.warn("[Journal] getJournalEntriesForLastNDays: No userId provided."),[];try{let t=new Date,d=(0,n.D)(t),u=(0,i.o)((0,l.e)(t,r-1)),c=(0,o.P)((0,o.rJ)(a.db,s),(0,o._M)("userId","==",e),(0,o._M)("date",">=",u.toISOString()),(0,o._M)("date","<=",d.toISOString()),(0,o.My)("date","desc")),f=await (0,o.GG)(c),h=[];return f.forEach(e=>{h.push({id:e.id,...e.data()})}),h}catch(t){throw console.error("[Journal] Error fetching journal entries for last ".concat(r," days for userId ").concat(e,":"),t),t}}async function h(e,r){if(!e)throw Error("[Journal] addJournalEntry: No userId provided.");console.log("[Journal] addJournalEntry called for userId: ".concat(e));try{let t=await (0,o.gS)((0,o.rJ)(a.db,s),{userId:e,content:r.content,moodRating:r.moodRating,date:r.date,createdAt:(0,o.O5)(),updatedAt:(0,o.O5)()});console.log("[Journal] Added entry with ID: ".concat(t.id," for userId ").concat(e,"."));let n=await (0,o.x7)(t);return{id:n.id,...n.data()}}catch(r){throw console.error("[Journal] Error adding journal entry for userId ".concat(e,":"),r),r}}async function g(e){if(console.log("[Journal] getJournalEntryById called for entryId: ".concat(e)),!e)return console.warn("[Journal] getJournalEntryById: No entryId provided."),null;try{let r=(0,o.H9)(a.db,s,e),t=await (0,o.x7)(r);if(!t.exists())return console.log("[Journal] No entry found for ID ".concat(e,".")),null;{let e={id:t.id,...t.data()};return console.log("[Journal] Found entry by ID:",e),e}}catch(r){throw console.error("[Journal] Error fetching journal entry by ID ".concat(e,":"),r),r}}async function y(e,r){if(console.log("[Journal] updateJournalEntry called for entryId: ".concat(e)),!e)throw Error("[Journal] updateJournalEntry: No entryId provided.");try{let t=(0,o.H9)(a.db,s,e);if(!(await (0,o.x7)(t)).exists())return console.warn("[Journal] Update failed: No entry found for ID ".concat(e,".")),null;let n={...r};r.date&&(n.date=r.date),n.updatedAt=(0,o.O5)(),await (0,o.mZ)(t,n),console.log("[Journal] Updated entry with ID: ".concat(e,"."));let i=await (0,o.x7)(t);if(i.exists())return{id:i.id,...i.data()};return null}catch(r){throw console.error("[Journal] Error updating journal entry ".concat(e,":"),r),r}}async function p(e){if(console.log("[Journal] deleteJournalEntry called for entryId: ".concat(e)),!e)throw Error("[Journal] deleteJournalEntry: No entryId provided.");try{let r=(0,o.H9)(a.db,s,e);return await (0,o.kd)(r),console.log("[Journal] Deleted entry with ID: ".concat(e,".")),!0}catch(r){throw console.error("[Journal] Error deleting journal entry ".concat(e,":"),r),r}}},372:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>g});var o=t(37876),a=t(14232),n=t(18847),i=t.n(n),l=t(5747),s=t(72636),d=t(49105),u=t(109),c=t(31928),f=t(18305),h=t(51569);function g(){let{user:e}=(0,d.A)(),{toast:r}=(0,c.dj)(),[t,n]=(0,a.useState)([]),[i,f]=(0,a.useState)([]),[g,y]=(0,a.useState)(void 0),[p,m]=(0,a.useState)(null),[w,I]=(0,a.useState)(null),[E,J]=(0,a.useState)(!0),[A,S]=(0,a.useState)(!1),[b,v]=(0,a.useState)(!1),x=(0,a.useCallback)(async()=>{if(e){J(!0);try{let[r,t]=await Promise.all([(0,u.g)(e.id),(0,u.ib)(e.id,7)]);n(r),f(t),r.length>0&&!g?y(r[0].id):0===r.length&&y(void 0)}catch(e){console.error("Failed to fetch entries for mood tracker:",e),r({title:"Error",description:"Could not load journal entries.",variant:"destructive"})}finally{J(!1)}}else n([]),f([]),y(void 0),J(!1)},[e,r,g]);return(0,a.useEffect)(()=>{x()},[x]),(0,o.jsx)(h.q,{children:(0,o.jsx)(l.L,{children:(0,o.jsx)(s.s,{children:"AI Mood Tracker"})})})}i()(()=>Promise.all([t.e(210),t.e(635),t.e(520)]).then(t.bind(t,98520)).then(e=>e.MoodChart),{loadableGenerated:{webpack:()=>[98520]},ssr:!1,loading:()=>(0,o.jsx)(f.E,{className:"h-[300px] w-full rounded-lg"})})},5747:(e,r,t)=>{"use strict";t.d(r,{L:()=>n});var o=t(37876),a=t(46907);function n(e){let{children:r,className:t}=e;return(0,o.jsx)("div",{className:(0,a.cn)("container mx-auto px-4 py-8 sm:px-6 lg:px-8",t),children:r})}},18305:(e,r,t)=>{"use strict";t.d(r,{E:()=>n});var o=t(37876),a=t(46907);function n(e){let{className:r,...t}=e;return(0,o.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",r),...t})}},31928:(e,r,t)=>{"use strict";t.d(r,{dj:()=>f});var o=t(14232);let a=0,n=new Map,i=e=>{if(n.has(e))return;let r=setTimeout(()=>{n.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,r)},l=(e,r)=>{switch(r.type){case"ADD_TOAST":return{...e,toasts:[r.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===r.toast.id?{...e,...r.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=r;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===r.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==r.toastId)}}},s=[],d={toasts:[]};function u(e){d=l(d,e),s.forEach(e=>{e(d)})}function c(e){let{...r}=e,t=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),o=()=>u({type:"DISMISS_TOAST",toastId:t});return u({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:e=>{e||o()}}}),{id:t,dismiss:o,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function f(){let[e,r]=o.useState(d);return o.useEffect(()=>(s.push(r),()=>{let e=s.indexOf(r);e>-1&&s.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},46907:(e,r,t)=>{"use strict";t.d(r,{cn:()=>n});var o=t(69241),a=t(29573);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,o.$)(r))}},49105:(e,r,t)=>{"use strict";t.d(r,{A:()=>f});var o=t(14232),a=t(14e3),n=t(29917),i=t(82964),l=t(52007);let s="users";async function d(e,r,t){if(!t)throw Error("Password is required for signup.");try{let o=(await (0,n.eJ)(l.j,e,t)).user;await (0,n.gA)(o),console.log("[Auth] Verification email sent.");let a={id:o.uid,email:o.email||e,name:r,emailVerified:o.emailVerified};return await (0,i.BN)((0,i.H9)(l.db,s,o.uid),a),console.log("[Auth] User signed up and profile created in Firestore:",a),a}catch(e){throw console.error("[Auth] Error during signup:",e.message),e}}async function u(e,r){if(!r)throw Error("Password is required for login.");try{let t=(await (0,n.x9)(l.j,e,r)).user,o=(0,i.H9)(l.db,s,t.uid),a=await (0,i.x7)(o);if(a.exists())a.data().emailVerified!==t.emailVerified&&await (0,i.mZ)(o,{emailVerified:t.emailVerified});else{console.warn("[Auth] User profile not found in Firestore during login. Creating a basic one.");let r={id:t.uid,email:t.email||e,name:t.displayName||e.split("@")[0],emailVerified:t.emailVerified};await (0,i.BN)(o,r)}return console.log("[Auth] User authentication successful via signInWithEmailAndPassword."),t}catch(e){throw console.error("[Auth] Error during login:",e.message),e}}async function c(){try{await (0,n.CI)(l.j),console.log("[Auth] User signed out.")}catch(e){throw console.error("[Auth] Error during sign out:",e.message),e}}function f(){let[e,r]=(0,o.useState)(null),[t,f]=(0,o.useState)(!0),h=(0,a.useRouter)();(0,o.useEffect)(()=>{var e;let t=(e=e=>{r(e),f(!1),e||["/login","/signup"].includes(window.location.pathname)},(0,n.hg)(l.j,async r=>{if(r){let o=(0,i.H9)(l.db,s,r.uid),a=await (0,i.x7)(o);if(a.exists()){let t=a.data();t.emailVerified!==r.emailVerified&&await (0,i.mZ)(o,{emailVerified:r.emailVerified}),e({...t,id:r.uid,email:r.email||t.email,emailVerified:r.emailVerified})}else{var t;console.warn("[Auth] User profile not found for UID: ".concat(r.uid," during onAuthStateChanged. Creating a basic profile."));let o={id:r.uid,email:r.email||"",name:r.displayName||(null==(t=r.email)?void 0:t.split("@")[0])||"User",emailVerified:r.emailVerified};try{await (0,i.BN)((0,i.H9)(l.db,s,r.uid),o),e(o)}catch(t){console.error("[Auth] Failed to create fallback user profile in Firestore:",t),e({id:r.uid,email:r.email||"",name:r.displayName||"User",emailVerified:r.emailVerified})}}}else e(null)}));return()=>t()},[]);let g=(0,o.useCallback)(async(e,r)=>{f(!0);try{let t=await u(e,r);return t&&h.push("/dashboard"),t}catch(e){throw console.error("[AuthHook] Login failed:",e),f(!1),e}},[h]);return{user:e,isLoading:t,login:g,signup:(0,o.useCallback)(async(e,r,t)=>{f(!0);try{let o=await d(e,r,t);return h.push("/login"),o}catch(e){throw console.error("[AuthHook] Signup failed:",e),f(!1),e}},[h]),logout:(0,o.useCallback)(async()=>{f(!0);try{await c(),h.push("/login")}catch(e){console.error("[AuthHook] Logout failed:",e),f(!1)}},[h])}}},51569:(e,r,t)=>{"use strict";t.d(r,{q:()=>l});var o=t(37876),a=t(14232),n=t(14e3),i=t(49105);let l=e=>{let{children:r}=e,{user:t,isLoading:l}=(0,i.A)(),s=(0,n.useRouter)();return((0,a.useEffect)(()=>{l||t||s.replace("/login")},[t,l,s]),l||!t)?null:(0,o.jsx)(o.Fragment,{children:r})}},52007:(e,r,t)=>{"use strict";let o;t.d(r,{db:()=>d,j:()=>s});var a=t(16042),n=t(29917),i=t(82964);let l={apiKey:"AIzaSyBiidZpnKIjM59jXZoCgEWvylA1CQjc2PM",authDomain:"soloura-health.firebaseapp.com",projectId:"soloura-health",storageBucket:"soloura-health.firebasestorage.app",messagingSenderId:"179780492964",appId:"1:179780492964:web:665c44b3a7fe5906e11031",measurementId:"G-L6B1SZS5C4"};l.apiKey&&l.authDomain&&l.projectId||console.error("Firebase configuration is missing or incomplete. Please check your environment variables (e.g., .env.local for development or hosting provider settings for production)."),o=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)(l);let s=(0,n.xI)(o),d=(0,i.aU)(o)},72043:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/mood-tracker",function(){return t(372)}])},72636:(e,r,t)=>{"use strict";t.d(r,{s:()=>n});var o=t(37876),a=t(46907);function n(e){let{children:r,className:t}=e;return(0,o.jsx)("h1",{className:(0,a.cn)("text-2xl sm:text-3xl font-headline font-bold text-primary mb-6",t),children:r})}}},e=>{var r=r=>e(e.s=r);e.O(0,[671,389,679,749,769,636,593,792],()=>r(72043)),_N_E=e.O()}]);